{"version":3,"file":"stack.js","names":["useToggleScope","inject","onScopeDispose","provide","reactive","readonly","shallowRef","toRaw","toRef","toValue","watchEffect","getCurrentInstance","StackSymbol","Symbol","for","globalStack","useStack","isActive","zIndex","disableGlobalStack","vm","createStackEntry","parent","undefined","stack","activeChildren","Set","_zIndex","Number","lastZIndex","at","value","push","uid","add","idx","findIndex","v","splice","delete","globalTop","_isTop","setTimeout","localTop","size","stackStyles"],"sources":["../../src/composables/stack.ts"],"sourcesContent":["// Composables\nimport { useToggleScope } from '@/composables/toggleScope'\n\n// Utilities\nimport {\n  inject,\n  onScopeDispose,\n  provide,\n  reactive,\n  readonly,\n  shallowRef,\n  toRaw,\n  toRef,\n  toValue,\n  watchEffect,\n} from 'vue'\nimport { getCurrentInstance } from '@/util'\n\n// Types\nimport type { InjectionKey, MaybeRefOrGetter, Ref } from 'vue'\n\nconst StackSymbol: InjectionKey<StackProvide> = Symbol.for('vuetify:stack')\n\ninterface StackProvide {\n  activeChildren: Set<number>\n}\n\nconst globalStack = reactive<[uid: number, zIndex: number][]>([])\n\nexport function useStack (\n  isActive: Readonly<Ref<boolean>>,\n  zIndex: MaybeRefOrGetter<string | number>,\n  disableGlobalStack: boolean\n) {\n  const vm = getCurrentInstance('useStack')\n  const createStackEntry = !disableGlobalStack\n\n  const parent = inject(StackSymbol, undefined)\n  const stack: StackProvide = reactive({\n    activeChildren: new Set<number>(),\n  })\n  provide(StackSymbol, stack)\n\n  const _zIndex = shallowRef(Number(toValue(zIndex)))\n  useToggleScope(isActive, () => {\n    const lastZIndex = globalStack.at(-1)?.[1]\n    _zIndex.value = lastZIndex ? lastZIndex + 10 : Number(toValue(zIndex))\n\n    if (createStackEntry) {\n      globalStack.push([vm.uid, _zIndex.value])\n    }\n\n    parent?.activeChildren.add(vm.uid)\n\n    onScopeDispose(() => {\n      if (createStackEntry) {\n        const idx = toRaw(globalStack).findIndex(v => v[0] === vm.uid)\n        globalStack.splice(idx, 1)\n      }\n\n      parent?.activeChildren.delete(vm.uid)\n    })\n  })\n\n  const globalTop = shallowRef(true)\n  if (createStackEntry) {\n    watchEffect(() => {\n      const _isTop = globalStack.at(-1)?.[0] === vm.uid\n      setTimeout(() => globalTop.value = _isTop)\n    })\n  }\n\n  const localTop = toRef(() => !stack.activeChildren.size)\n\n  return {\n    globalTop: readonly(globalTop),\n    localTop,\n    stackStyles: toRef(() => ({ zIndex: _zIndex.value })),\n  }\n}\n"],"mappings":"AAAA;AAAA,SACSA,cAAc,4BAEvB;AACA,SACEC,MAAM,EACNC,cAAc,EACdC,OAAO,EACPC,QAAQ,EACRC,QAAQ,EACRC,UAAU,EACVC,KAAK,EACLC,KAAK,EACLC,OAAO,EACPC,WAAW,QACN,KAAK;AAAA,SACHC,kBAAkB,4BAE3B;AAGA,MAAMC,WAAuC,GAAGC,MAAM,CAACC,GAAG,CAAC,eAAe,CAAC;AAM3E,MAAMC,WAAW,GAAGX,QAAQ,CAAkC,EAAE,CAAC;AAEjE,OAAO,SAASY,QAAQA,CACtBC,QAAgC,EAChCC,MAAyC,EACzCC,kBAA2B,EAC3B;EACA,MAAMC,EAAE,GAAGT,kBAAkB,CAAC,UAAU,CAAC;EACzC,MAAMU,gBAAgB,GAAG,CAACF,kBAAkB;EAE5C,MAAMG,MAAM,GAAGrB,MAAM,CAACW,WAAW,EAAEW,SAAS,CAAC;EAC7C,MAAMC,KAAmB,GAAGpB,QAAQ,CAAC;IACnCqB,cAAc,EAAE,IAAIC,GAAG,CAAS;EAClC,CAAC,CAAC;EACFvB,OAAO,CAACS,WAAW,EAAEY,KAAK,CAAC;EAE3B,MAAMG,OAAO,GAAGrB,UAAU,CAACsB,MAAM,CAACnB,OAAO,CAACS,MAAM,CAAC,CAAC,CAAC;EACnDlB,cAAc,CAACiB,QAAQ,EAAE,MAAM;IAC7B,MAAMY,UAAU,GAAGd,WAAW,CAACe,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;IAC1CH,OAAO,CAACI,KAAK,GAAGF,UAAU,GAAGA,UAAU,GAAG,EAAE,GAAGD,MAAM,CAACnB,OAAO,CAACS,MAAM,CAAC,CAAC;IAEtE,IAAIG,gBAAgB,EAAE;MACpBN,WAAW,CAACiB,IAAI,CAAC,CAACZ,EAAE,CAACa,GAAG,EAAEN,OAAO,CAACI,KAAK,CAAC,CAAC;IAC3C;IAEAT,MAAM,EAAEG,cAAc,CAACS,GAAG,CAACd,EAAE,CAACa,GAAG,CAAC;IAElC/B,cAAc,CAAC,MAAM;MACnB,IAAImB,gBAAgB,EAAE;QACpB,MAAMc,GAAG,GAAG5B,KAAK,CAACQ,WAAW,CAAC,CAACqB,SAAS,CAACC,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,KAAKjB,EAAE,CAACa,GAAG,CAAC;QAC9DlB,WAAW,CAACuB,MAAM,CAACH,GAAG,EAAE,CAAC,CAAC;MAC5B;MAEAb,MAAM,EAAEG,cAAc,CAACc,MAAM,CAACnB,EAAE,CAACa,GAAG,CAAC;IACvC,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,MAAMO,SAAS,GAAGlC,UAAU,CAAC,IAAI,CAAC;EAClC,IAAIe,gBAAgB,EAAE;IACpBX,WAAW,CAAC,MAAM;MAChB,MAAM+B,MAAM,GAAG1B,WAAW,CAACe,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,KAAKV,EAAE,CAACa,GAAG;MACjDS,UAAU,CAAC,MAAMF,SAAS,CAACT,KAAK,GAAGU,MAAM,CAAC;IAC5C,CAAC,CAAC;EACJ;EAEA,MAAME,QAAQ,GAAGnC,KAAK,CAAC,MAAM,CAACgB,KAAK,CAACC,cAAc,CAACmB,IAAI,CAAC;EAExD,OAAO;IACLJ,SAAS,EAAEnC,QAAQ,CAACmC,SAAS,CAAC;IAC9BG,QAAQ;IACRE,WAAW,EAAErC,KAAK,CAAC,OAAO;MAAEU,MAAM,EAAES,OAAO,CAACI;IAAM,CAAC,CAAC;EACtD,CAAC;AACH","ignoreList":[]}